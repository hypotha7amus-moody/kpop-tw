<script src="data.js"></script>
<script>
    const listDiv = document.getElementById('list');
    const searchInput = document.getElementById('searchInput');

    // 1. è¶…å¼·é˜²å‘†æ¸…ç†ï¼šå¿½ç•¥å¤§å°å¯«ã€ç©ºæ ¼ã€æ¨™é¡Œåˆ—
    function getCleanData(raw) {
        if (!Array.isArray(raw) || raw.length === 0) return [];
        
        return raw.filter(item => {
            // éæ¿¾æ‰çœ‹èµ·ä¾†åƒæ¨™é¡Œçš„è³‡æ–™ (ä¾‹å¦‚ group æ¬„ä½å‰›å¥½å« "group")
            const isHeader = String(item.group || "").toLowerCase().trim() === 'group';
            return !isHeader;
        }).map(item => {
            const cleanObj = {};
            // åŒæ™‚è™•ç†å¤§å°å¯«æ¨™é¡Œï¼Œç¢ºä¿ç„¡è«– Google Sheet å¯« Date æˆ– date éƒ½èƒ½è®€åˆ°
            Object.keys(item).forEach(key => {
                const k = key.replace(/['"]+/g, '').trim().toLowerCase();
                const v = String(item[key]).replace(/['"]+/g, '').trim();
                cleanObj[k] = v;
            });
            return {
                date: cleanObj.date || cleanObj['æ—¥æœŸ'] || 'æœªå®š',
                group: cleanObj.group || cleanObj['åœ˜é«”'] || 'æœªçŸ¥æ´»å‹•',
                link: cleanObj.link || cleanObj['é€£çµ'] || '#',
                source: cleanObj.source || cleanObj['ä¾†æº'] || 'å®˜æ–¹'
            };
        });
    }

    // å–å¾—è³‡æ–™
    const raw = (typeof kpopData !== 'undefined') ? kpopData : [];
    const data = getCleanData(raw);

    function render(items) {
        if (items.length === 0) {
            listDiv.innerHTML = '<div class="text-center py-10 text-gray-400 font-bold text-lg">ç›®å‰æ²’æœ‰ç¬¦åˆçš„è¡Œç¨‹ ğŸ”</div>';
            return;
        }
        listDiv.innerHTML = items.map(i => `
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 mb-4">
                <div class="flex justify-between text-[10px] mb-2 font-bold text-pink-500">
                    <span>${i.source}</span>
                    <span class="text-gray-400">${i.date}</span>
                </div>
                <h2 class="text-lg font-bold text-gray-800 mb-4">${i.group}</h2>
                <a href="${i.link}" target="_blank" class="block text-center bg-gray-900 text-white text-sm font-bold py-3 rounded-xl shadow-lg hover:bg-pink-600 transition-all">å‰å¾€å”®ç¥¨é é¢</a>
            </div>
        `).join('');
    }

    // æœå°‹åŠŸèƒ½
    searchInput.addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase().trim();
        const filtered = data.filter(i => 
            i.group.toLowerCase().includes(val) || 
            i.source.toLowerCase().includes(val)
        );
        render(filtered);
    });

    // ç«‹å³åŸ·è¡Œï¼šä¸è¦å»¶é²ï¼Œç›´æ¥é¡¯ç¤º
    if (data.length > 0) {
        render(data);
    } else {
        listDiv.innerHTML = '<div class="text-center py-10 text-red-400">ç³»çµ±æ‰¾ä¸åˆ°è³‡æ–™ï¼Œè«‹ç¢ºèª Google Sheet ç¬¬ä¸€åˆ—æ¨™é¡Œæ˜¯å¦æ­£ç¢ºã€‚</div>';
    }
</script>
