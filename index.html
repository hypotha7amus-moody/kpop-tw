<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Pop å°ç£è¡Œç¨‹è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background-color: #f9fafb; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #ec4899; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-white border-b sticky top-0 z-50 p-4 shadow-sm">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-pink-600">ğŸ‡°ğŸ‡· K-POP è¡Œç¨‹</h1>
            <div id="status" class="text-[10px] text-green-500 font-bold">â— å·²é€£ç·š</div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4">
        <input type="text" id="searchInput" placeholder="æœå°‹å¶åƒæˆ–åœ˜é«”..." 
            class="w-full p-4 rounded-2xl border-none shadow-md mb-6 focus:ring-2 focus:ring-pink-500">

        <div id="list" class="space-y-4">
            <div class="flex flex-col items-center justify-center py-20 text-gray-400">
                <div class="loading-spinner mb-4"></div>
                <p>æ­£åœ¨åŒæ­¥é›²ç«¯è³‡æ–™...</p>
            </div>
        </div>
    </main>

    <script src="data.js"></script>

    <script>
        // æ ¸å¿ƒä¿®å¾©é‚è¼¯ï¼šå¼·åˆ¶æ¸…ç†æ‰€æœ‰å¯èƒ½çš„æ ¼å¼éŒ¯èª¤
        function safeClean(data) {
            if (!Array.isArray(data)) return [];
            return data.map(obj => {
                const newObj = {};
                Object.keys(obj).forEach(key => {
                    // æ¸…ç†éµåï¼šå»å¼•è™Ÿã€å»ç©ºæ ¼ã€è½‰å°å¯«
                    const cleanKey = key.replace(/['"]+/g, '').trim().toLowerCase();
                    // æ¸…ç†å…§å®¹ï¼šå»å¼•è™Ÿã€å»ç©ºæ ¼
                    const cleanVal = String(obj[key]).replace(/['"]+/g, '').trim();
                    newObj[cleanKey] = cleanVal;
                });
                return newObj;
            });
        }

        const listDiv = document.getElementById('list');
        const searchInput = document.getElementById('searchInput');
        
        // å–å¾—æ¸…ç†å¾Œçš„è³‡æ–™
        const rawData = (typeof kpopData !== 'undefined') ? kpopData : [];
        const cleanData = safeClean(rawData);

function render(items) {
    if (items.length === 0) {
        listDiv.innerHTML = '<div class="text-center py-10 text-gray-400 font-bold text-lg">ç›®å‰æ²’æœ‰ç¬¦åˆçš„è¡Œç¨‹ ğŸ”</div>';
        return;
    }

    const now = new Date();

    listDiv.innerHTML = items.map(i => {
        // å˜—è©¦è§£ææ—¥æœŸ
        const eventDate = new Date(i.date);
        let statusTag = '';
        
        // å¦‚æœæ—¥æœŸè§£ææˆåŠŸï¼Œè¨ˆç®—è·é›¢å¤©æ•¸
        if (!isNaN(eventDate)) {
            const diffTime = eventDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                statusTag = `<span class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded text-[10px]">å€’æ•¸ ${diffDays} å¤©</span>`;
            } else if (diffDays === 0) {
                statusTag = `<span class="bg-red-50 text-red-600 px-2 py-0.5 rounded text-[10px] animate-pulse">ä»Šå¤©é–‹æ¼”ï¼</span>`;
            } else {
                statusTag = `<span class="bg-gray-100 text-gray-400 px-2 py-0.5 rounded text-[10px]">å·²çµæŸ</span>`;
            }
        }

        return `
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 mb-4 transition-all hover:shadow-md">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex gap-2">
                        <span class="bg-pink-50 text-pink-500 px-2 py-0.5 rounded text-[10px] font-bold">${i.source}</span>
                        ${statusTag}
                    </div>
                    <span class="text-gray-400 text-[10px] font-mono">${i.date}</span>
                </div>
                <h2 class="text-lg font-extrabold text-gray-800 mb-5 leading-tight">${i.group}</h2>
                <a href="${i.link}" target="_blank" class="block text-center bg-gray-900 text-white text-sm font-bold py-4 rounded-2xl shadow-lg active:scale-95 hover:bg-pink-600 transition-all">
                    å‰å¾€æŸ¥çœ‹è©³æƒ…
                </a>
            </div>
        `;
    }).join('');
}
        // æœå°‹é‚è¼¯
        searchInput.addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase().trim();
            const filtered = cleanData.filter(i => 
                (i.group || "").toLowerCase().includes(val) || 
                (i.source || "").toLowerCase().includes(val)
            );
            render(filtered);
        });

        // å•Ÿå‹•æ¸²æŸ“
        setTimeout(() => {
            if (cleanData.length === 0) {
                listDiv.innerHTML = '<div class="text-center py-10 text-red-400">è¼‰å…¥å¤±æ•—ï¼šdata.js å…§å®¹æ ¼å¼ä¸æ­£ç¢º</div>';
            } else {
                render(cleanData);
            }
        }, 500); // ç¨å¾®å»¶é²è®“å‹•ç•«é †æš¢
    </script>
</body>
</html>

